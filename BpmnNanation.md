# BPMN нотация.

## Схема Bpmn
![plot](./Documents/Images/bpmn_001.jpg)<br>

## Start Event
Начало процесса <br>
Элемент для обозначения начало процесса <br>
![plot](./Documents/Images/start_event.jpg)<br>
Требования:
1. Один на схеме.
2. Имеет один выход.


## Service Task
Атомарный блок выполннения кода. <br>
Например, выполняет атомарный кусок логики.<br>
![plot](./Documents/Images/service_task.jpg)<br>
Требования:
1. Имеет один вход.
2. Имеет один выход.

## Send Task
Атомарный блок выполннения кода. <br>
Конечная цель этого блока отправить сообщения в шину данных.
Сообщения отправляет во внешние брокеры (**движек BpmnDotNet не контролирует жизненный цикл этого сообщения**)

![plot](./Documents/Images/send_task.jpg)<br>
Требования:
1. Имеет один вход.
2. Имеет один выход.

## Receive Task
Атомарный блок выполннения кода. <br>
Конечная цель этого блока дождаться сообщения из внутренней шины данных (задействован BpmnDotNet)

![plot](./Documents/Images/receive_task.jpg)<br>

Требования:
1. Имеет один вход.
2. Имеет один выход.


## Exclusive Gateway
Эксклюзивный шлюз, предлагает выбрать направление движения алгоритма. 
Количество ветвей не ограниченно.

![plot](./Documents/Images/exlusive_gateway.jpg)

Требования: <br>
1. Всегда требует выбора направления движения.
2. На схеме должно быть открывающий шлюз и закрывающий (четное число шлюзов).

## Parallel Gateway
Параллельный шлюз. Запускает несколько ветвей процесса и дожидается их завершения. 
Заблокирует процесс на закрывающем шлюзе до завершения всех входящих ветвей.

![plot](./Documents/Images/parallel_gateway.jpg)

Требования:<br>
1. На схеме должно быть открывающий шлюз и закрывающий (четное число шлюзов).

## Sub process
Дочерний процесс. Запускает субПроцесс.

![plot](./Documents/Images/sub_process.jpg)

Требования:<br>
1. Имеет один вход.
2. Имеет один выход.
3. Ожидание его реализовывать в коде (можно как ожидать завершения, так и продолжить выполнение основного процесса)


## End Event
Окончания процесса <br>
Элемент для обозначения окончание процесса <br>
![plot](./Documents/Images/end_event.jpg)<br>
Требования:
1. Один на схеме.
2. Имеет один выход.

## Sequence Flow
Это собственно стрелочка от блока к блоку.

## Описания кода реализации:
1. Пример кода Sample.ConsoleApp
2. Для реализации обработчика блока определяем и регистрируем в контейнере IBpmnHandler
3. Через весь процесс идет IContextBpmnProcess
4. Для реализации маршрутизации заполняем IExclusiveGateWay
5. Отправка сообщений ( ReceiveTask) IBpmnClient.SendMessage
6. Для реализации получения сообщений (ReceiveTask) в контексте реализуем IMessageReceiveTask
7. С точки зрения реализация IBpmnHandler для блоков ServiceTask, SendTask, SubProcess - одинаковая. Различие только в начертании на схеме и функциональной нагрузки.
8. Все блоки на схеме можно определить как IBpmnHandler и реализовать функционал (кроме flow).
9. При выбрасывании ошибки весь процесс останавливается. 

## TODO:
1. Добавить проверку целостности Bpmn
2. Добавить сохранение в бд.
3. Написать утилиту для просмотра состояния процессов (по аналогии camunda)